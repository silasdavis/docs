version: 2

jobs:
  build:
    docker:
      - image: node:9-alpine
    steps:
      - checkout
      - run:
          name: "NPM Install"
          command: npm install
      - run:
          name: "NPM Test"
          command: npm test
      - add_ssh_keys:
          fingerprints:
            - "5e:f3:47:75:34:c7:83:93:51:48:31:6a:3a:1a:de:85"
      - run:
          name: "Merge to Master"
          command: |
            git config --global user.name "Billings, a Bot"
            git config --global user.email "billings@monax.io"
            git clone git@github.com:agreements-network/docs build
            npm run-script build
            cd build
            git add -A :/
            git commit -m "Automatic document generation: $CIRCLE_SHA1"
            git push origin master
      # - deploy:
      #     command: |
      #       if [ "${CIRCLE_BRANCH}" == "master" ]; then
      #         echo 'example.com ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJiGRY6N9WYQ0vy6cTiwAgNbc6ueJmVo/EafBtmT7bcD6cQMbipYM/KfYQ2lCn2TxqWepZKYoyoVQXgArycCOns=' >> ~/.ssh/known_hosts
      #         rsync -va --delete src/public/ staticweb@example.com:/var/www/
      #       fi

